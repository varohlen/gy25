---
import type { CollectionEntry } from 'astro:content';
import GradeRequirements from './gradereq.astro';

interface KnowledgeRequirement {
  text: string;
  gradeStep?: string;
}

interface Course {
  code: string;
  name: string;
  points?: string;
  description?: string;
  centralContent?: {
    text: string;
  };
  knowledgeRequirements?: KnowledgeRequirement[];
}

interface Props {
  course: Course;
  subject: CollectionEntry<'gy11-subjects'>;
}

const { course, subject } = Astro.props;
const relatedCourses = subject.data.courses?.filter((c) => c.code !== course.code) ?? [];
---

<div class="max-w-4xl mx-auto space-y-6">
  <section class="bg-white rounded-lg shadow-sm p-6">
    <div class="flex flex-wrap items-baseline justify-between gap-3">
      <h1 class="text-2xl font-bold text-gray-900">{course.name}</h1>
      <div class="text-sm text-gray-600">
        {course.points ? `${course.points} poäng` : ''}
      </div>
    </div>
    <p class="text-sm text-gray-500 font-mono mt-1">{course.code}</p>
    <p class="text-sm text-gray-600 mt-2">Från ämnet {subject.data.name}</p>
    {course.description && (
      <div class="prose max-w-none mt-4" set:html={course.description} />
    )}
  </section>

  {course.centralContent?.text && (
    <section class="bg-white rounded-lg shadow-sm p-6">
      <h2 class="text-xl font-bold text-gray-900 mb-4">Centralt innehåll</h2>
      <div class="prose max-w-none [&_ul]:list-disc [&_ul]:pl-8" set:html={course.centralContent.text} />
    </section>
  )}

  {course.knowledgeRequirements && course.knowledgeRequirements.length > 0 && (
    <GradeRequirements
      requirements={course.knowledgeRequirements.map((req) => ({
        text: req.text,
        gradeStep: req.gradeStep || '',
      }))}
      title="Betygskriterier / Kunskapskrav"
      defaultView="list"
    />
  )}

  {relatedCourses.length > 0 && (
    <section class="bg-white rounded-lg shadow-sm p-6">
      <h2 class="text-xl font-bold text-gray-900 mb-4">Fler kurser i ämnet</h2>
      <div class="space-y-2">
        {relatedCourses.map((related) => (
          <a
            href={`/gy11/${subject.data.code.toLowerCase()}/${related.code.toLowerCase()}`}
            class="block rounded-lg border border-gray-100 bg-gray-50 px-4 py-3 hover:bg-blue-50"
          >
            <div class="flex flex-wrap items-center justify-between gap-2">
              <p class="font-medium text-gray-900">{related.name}</p>
              <p class="text-sm text-gray-600">{related.points ? `${related.points} poäng` : ''}</p>
            </div>
            <p class="text-xs text-gray-500 mt-1 font-mono">{related.code}</p>
          </a>
        ))}
      </div>
    </section>
  )}
</div>
