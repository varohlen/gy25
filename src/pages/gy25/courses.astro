---
import { getCollection } from 'astro:content';
import GY25Layout from '../../layouts/GY25Layout.astro';

const subjects = await getCollection('gy25-subjects');

// Flatten all courses into a single array with subject information
const courses = subjects.flatMap(subject => 
  subject.data.courses?.map(course => ({
    ...course,
    subjectName: subject.data.name,
    subjectCode: subject.data.code,
  })) || []
);

// Sort courses by subject name and then course name
courses.sort((a, b) => {
  const subjectCompare = a.subjectName.localeCompare(b.subjectName);
  if (subjectCompare !== 0) return subjectCompare;
  return a.name.localeCompare(b.name);
});
---

<GY25Layout 
  activeView="courses"
  searchPlaceholder="Sök på ämne, nivå eller kod..."
>
  <div class="overflow-hidden rounded-lg border border-gray-200 bg-white">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th scope="col" class="px-6 py-3 text-left text-sm font-semibold text-gray-900">Ämne</th>
          <th scope="col" class="px-6 py-3 text-left text-sm font-semibold text-gray-900">Nivå</th>
          <th scope="col" class="px-6 py-3 text-left text-sm font-semibold text-gray-900">Kod</th>
          <th scope="col" class="px-6 py-3 text-right text-sm font-semibold text-gray-900">Poäng</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        {courses.map((course) => (
          <tr 
            class="hover:bg-gray-50"
            data-searchable={`${course.subjectName.toLowerCase()} ${course.name.toLowerCase()} ${course.code.toLowerCase()}`}
          >
            <td class="px-6 py-4">
              <div class="flex flex-col">
                <a 
                  href={`/gy25/${course.subjectCode.toLowerCase()}`} 
                  class="text-sm font-medium text-gray-900 hover:text-blue-600"
                >
                  {course.subjectName}
                </a>
                <span class="text-xs text-gray-500 font-mono">{course.subjectCode}</span>
              </div>
            </td>
            <td class="px-6 py-4 text-sm text-gray-900">{course.name}</td>
            <td class="px-6 py-4 text-sm font-mono text-gray-600">{course.code}</td>
            <td class="px-6 py-4 text-sm text-gray-900 text-right">{course.points}</td>
          </tr>
        ))}
      </tbody>
    </table>
  </div>
</GY25Layout>
