---
import Layout from './Layout.astro';
import GY11LegacyBanner from '../components/GY11LegacyBanner.astro';

interface Props {
  title?: string;
  searchPlaceholder?: string;
  activeView: 'subjects' | 'courses';
}

const {
  title = 'GY11',
  searchPlaceholder = 'Sök...',
  activeView,
} = Astro.props;
---

<Layout title={title}>
  <main class="max-w-7xl mx-auto px-4 py-12">
    <div class="flex flex-col items-center gap-6 mb-8">
      <nav class="flex gap-4">
        <a
          href="/gy11"
          class={`px-4 py-2 rounded-lg transition-colors ${
            activeView === 'subjects'
              ? 'bg-blue-600 text-white'
              : 'text-gray-600 hover:bg-gray-100'
          }`}
        >
          Ämnen
        </a>
        <a
          href="/gy11/courses"
          class={`px-4 py-2 rounded-lg transition-colors ${
            activeView === 'courses'
              ? 'bg-blue-600 text-white'
              : 'text-gray-600 hover:bg-gray-100'
          }`}
        >
          Kurser
        </a>
      </nav>

      <div class="w-full max-w-xl relative">
        <label for="search-input" class="sr-only">{searchPlaceholder}</label>
        <input
          type="text"
          id="search-input"
          aria-label={searchPlaceholder}
          class="w-full px-4 py-3 text-lg rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
          placeholder={searchPlaceholder}
        />
        <svg
          class="absolute right-4 top-3.5 w-6 h-6 text-gray-400"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
          />
        </svg>
      </div>

      <GY11LegacyBanner />
    </div>

    <div id="search-results" class="space-y-4">
      <slot />
      <div id="no-results" class="hidden text-center py-8 text-gray-500">
        Inga resultat hittades
      </div>
    </div>
  </main>
</Layout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const searchInput = document.getElementById('search-input') as HTMLInputElement;
    const noResults = document.getElementById('no-results');
    const searchableItems = document.querySelectorAll('[data-search], [data-searchable]');

    let debounceTimeout: ReturnType<typeof setTimeout>;

    if (searchInput && searchableItems.length > 0) {
      searchInput.addEventListener('input', (e) => {
        if (debounceTimeout) {
          clearTimeout(debounceTimeout);
        }

        debounceTimeout = setTimeout(() => {
          const searchTerm = (e.target as HTMLInputElement).value.toLowerCase().trim();
          let hasVisibleItems = false;

          searchableItems.forEach(item => {
            const searchText = (
              item.getAttribute('data-search') ||
              item.getAttribute('data-searchable') ||
              ''
            ).toLowerCase();

            const shouldShow = searchText.includes(searchTerm);
            (item as HTMLElement).style.display = shouldShow ? '' : 'none';

            if (shouldShow) hasVisibleItems = true;
          });

          if (noResults) {
            noResults.style.display = hasVisibleItems || !searchTerm ? 'none' : 'block';
          }
        }, 200);
      });

      searchInput.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          searchInput.value = '';
          searchableItems.forEach(item => {
            (item as HTMLElement).style.display = '';
          });
          if (noResults) noResults.style.display = 'none';
        }
      });
    }
  });
</script>
